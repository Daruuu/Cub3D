# ๐ฎ DIAGRAMA DE FLUJO COMPLETO - PROYECTO CUB3D

## ๐ FLUJO PRINCIPAL DESDE MAIN.C

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        ๐ MAIN.C                               โ
โ                     (Punto de entrada)                         โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ INICIALIZACIรN                                              โ
โ  โข init_default(&vars)                                          โ
โ  โข set_bonus(&vars.bonus)                                       โ
โ  โข vars.mlx = mlx_init()                                        โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ PARSER/ - Carga de Configuraciรณn                            โ
โ  โข load_args(argc, argv, &vars)                                โ
โ  โข check_iscub(argv[1])                                         โ
โ  โข load_f(argv[1], vars)                                        โ
โ  โข read_argument(vars, file)                                    โ
โ  โข read_argument_sounds(vars, file)                             โ
โ  โข read_argument_custom(vars, file)                             โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ง UTILS/ - Configuraciรณn y Validaciรณn                         โ
โ  โข check_define(&vars)                                          โ
โ  โข setup_render(&vars)                                          โ
โ  โข make_image(mlx, resx, resy)                                 โ
โ  โข make_blur_struct(mlx, img, shape)                           โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ฏ DECISIรN: Modo BMP o Juego                                  โ
โ  if (vars.bmp) {                                                โ
โ    โข render_and_save(&vars)                                     โ
โ    โข clean_and_exit(0, &vars)                                   โ
โ  } else {                                                       โ
โ    โข Crear ventana del juego                                    โ
โ    โข Configurar hooks de eventos                                โ
โ    โข Iniciar loop principal                                     โ
โ  }                                                              โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ฎ LOOP PRINCIPAL DEL JUEGO                                    โ
โ  mlx_loop_hook(mlx, render_next_frame, &vars)                  โ
โ  mlx_loop(mlx)                                                  โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ผ๏ธ RENDER_NEXT_FRAME()                                         โ
โ  (Funciรณn llamada cada frame)                                   โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  โ ยฟJugador muerto?                                             โ
โ  if (vars.player.health <= 0) {                                โ
โ    โข draw_death(vars)                                           โ
โ  } else {                                                       โ
โ    โข Continuar con renderizado                                  โ
โ  }                                                              โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ UPDATE_WORLD() - Actualizaciรณn del Mundo                   โ
โ  โข update_keybinds(vars)                                        โ
โ  โข update_motion(&player, vars)                                 โ
โ  โข refresh_pathfinding(vars)                                    โ
โ  โข draw_sprites(vars, true) [si bonus]                          โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐จ RENDERIZADO DE LA ESCENA                                   โ
โ  โข draw_floor(vars)                                             โ
โ  โข draw_skybox(vars) [si no BMP]                               โ
โ  โข ray(vars, &img) โ RAYCASTING                                 โ
โ  โข draw_sprites(vars, false)                                    โ
โ  โข draw_cursor(vars) [si no BMP]                               โ
โ  โข draw_hud(vars) [si no BMP]                                   โ
โ  โข render_hand(vars) [si no BMP]                                โ
โโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                      โ
                      โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ SINCRONIZACIรN Y REPETIR                                    โ
โ  โข mlx_put_image_to_window()                                   โ
โ  โข mlx_do_sync(mlx)                                            โ
โ  โข vars.time++                                                  โ
โ  โข Volver al inicio del loop                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ DETALLES DE CADA MรDULO

### ๐ PARSER/ - Flujo de Parseo
```
load_args() โ check_iscub() โ load_f() โ read_argument()
    โ              โ              โ           โ
Validar args   Verificar .cub   Cargar archivo  Parsear contenido
    โ              โ              โ           โ
    โโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโ
                   โผ
            read_argument_sounds()
                   โ
            read_argument_custom()
                   โ
            Configuraciรณn completa
```

### ๐จ RENDER/ - Flujo de Renderizado
```
ray() โ get_init_ray() โ do_ray() โ cast_forward()
  โ           โ            โ           โ
Lanzar    Inicializar   Procesar   Algoritmo
rayos     cada rayo     colisiรณn   DDA
  โ           โ            โ           โ
  โโโโโโโโโโโโโผโโโโโโโโโโโโโผโโโโโโโโโโโโ
              โผ
        get_collide_pos()
              โ
        check_colide()
              โ
        setup_line()
              โ
        set_img_strip()
```

### ๐ WORLD/ - Flujo del Mundo
```
update_motion() โ should_bob() โ get_collide_pos()
      โ              โ              โ
  Actualizar      Verificar      Calcular
  movimiento      bobing         colisiรณn
      โ              โ              โ
      โโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโ
                     โผ
              refresh_pathfinding()
                     โ
              cub_pathfinder()
                     โ
              cub_astar()
```

### ๐ฎ SPRITES/ - Flujo de Sprites
```
draw_sprites() โ cub_sprite_list() โ cub_doors()
      โ               โ                โ
  Renderizar      Gestionar        Sprites
  todos los       lista de         especรญficos
  sprites         sprites          (puertas)
      โ               โ                โ
      โโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโ
                      โผ
                cub_goomba()
                      โ
                Sprite enemigo
```

### ๐ง UTILS/ - Flujo de Utilidades
```
update_keybinds() โ set_keystate() โ make_keybinds()
      โ                โ                โ
  Actualizar        Establecer      Crear
  controles         estado tecla    keybinds
      โ                โ                โ
      โโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโ
                       โผ
                Gestiรณn de input
```

## ๐ฏ FLUJO DE EVENTOS

### โจ๏ธ Eventos de Teclado
```
key_press() โ set_keystate() โ update_keybinds()
     โ             โ              โ
  Tecla        Establecer      Actualizar
  presionada   estado          controles
     โ             โ              โ
     โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโ
                   โผ
            update_motion()
                   โ
            Movimiento del jugador
```

### ๐ฑ๏ธ Eventos de Ventana
```
clean_and_exit_z() โ clean_all() โ clean_images()
        โ               โ             โ
    Cerrar          Limpiar        Destruir
    ventana         todo           imรกgenes
        โ               โ             โ
        โโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
                        โผ
                  exit(0)
```

## ๐ FLUJO DE INICIALIZACIรN COMPLETO

```
main() โ init_default() โ set_bonus() โ mlx_init()
  โ           โ              โ            โ
Inicio    Valores        Modo bonus   Inicializar
          por defecto                 MLX
  โ           โ              โ            โ
  โโโโโโโโโโโโโผโโโโโโโโโโโโโโโผโโโโโโโโโโโโโ
               โผ
        load_args()
               โ
        check_iscub()
               โ
        load_f()
               โ
        read_argument()
               โ
        check_define()
               โ
        setup_render()
               โ
        Crear ventana y hooks
               โ
        Iniciar loop principal
```

## ๐ฎ FLUJO DE GAMEPLAY

```
Cada Frame:
  โ
update_world()
  โ
update_keybinds() โ update_motion() โ refresh_pathfinding()
  โ                    โ                    โ
Procesar input      Mover jugador        IA enemigos
  โ                    โ                    โ
  โโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโ
                       โผ
                draw_floor()
                       โ
                draw_skybox()
                       โ
                ray() โ RAYCASTING
                       โ
                draw_sprites()
                       โ
                draw_hud()
                       โ
                render_hand()
                       โ
                mlx_put_image_to_window()
                       โ
                Siguiente frame
```

## ๐ง FLUJO DE LIMPIEZA

```
clean_and_exit() โ clean_all() โ clean_images()
       โ              โ             โ
   Salir del      Limpiar        Destruir
   programa       memoria         imรกgenes
       โ              โ             โ
       โโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
                      โผ
                clear_map()
                      โ
                clear_sounds()
                      โ
                free_file()
                      โ
                exit(0)
```

## ๐ RESUMEN DE MรDULOS Y SUS RESPONSABILIDADES

| Mรณdulo | Responsabilidad Principal | Funciรณn Clave |
|--------|---------------------------|---------------|
| **main.c** | Punto de entrada y loop principal | `main()`, `render_next_frame()` |
| **parser/** | Parseo de archivos .cub | `load_args()`, `read_argument()` |
| **world/** | Lรณgica del mundo y jugador | `update_motion()`, `check_colide()` |
| **render/** | Motor de renderizado | `ray()`, `cast_forward()` |
| **sprites/** | Sistema de sprites | `draw_sprites()` |
| **pathfinder/** | IA y pathfinding | `refresh_pathfinding()` |
| **utils/** | Utilidades y controles | `update_keybinds()`, `clean_all()` |
| **other/** | Versiรณn sin sonido | `init_sound_empty()` |

## ๐ฏ PUNTOS CLAVE DEL FLUJO

1. **Inicializaciรณn**: main.c โ parser โ utils โ world
2. **Loop Principal**: render_next_frame() โ update_world() โ renderizado
3. **Raycasting**: ray() โ get_init_ray() โ cast_forward() (DDA)
4. **Input**: key_press() โ update_keybinds() โ update_motion()
5. **IA**: refresh_pathfinding() โ cub_astar()
6. **Sprites**: draw_sprites() โ gestiรณn de lista โ renderizado
7. **Limpieza**: clean_and_exit() โ clean_all() โ exit()

ยกEste es el flujo completo de tu proyecto Cub3D! ๐
